<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <link rel="stylesheet" href="./styles/index.css">
    <link rel="stylesheet" href="assets/style.css">
</head>

<body class="stop-scrolling">
    <section class="main" id="section1">
        <div style="flex: 1">
            <h1 class="glowing typewriter"></h1>
            <div id="name-wrapper" hidden>
                <input id="name" placeholder="Nombre"></input>
                <button onclick="onClick();">Continuar</button>
            </div>
        </div>
    </section>
    <section class="main" id="section2">
        <div style="position: absolute;">
            <h2 class="glowing">Centro de operaciones</h2>
            <p class="glowing" id="typewriter-2"></p>
        </div>
        <div class="horizontal">
            <a href="#section3" style="margin: 150px;">
                <object id="nuclear-plant" type="image/svg+xml" data="./img/esquema.svg"></object>
            </a>
        </div>
    </section>

    <section class="main" id="section3">
        <div class="navigation">
            <h2 class="glowing">Fisión nuclear</h2>
            <a href="#section2">Volver a la central</a>
        </div>
        <div class="horizontal">
            <div class="chat">
                <div class="yours messages">
                    <div class="message">
                        ¡El primer paso para obtener energía nuclear es la fisión de átomos!
                    </div>
                    <div class="message last">
                        Esto sucede porque los átomos de todo elemento tienen ciertas uniones que requieren energía para mantenerse unidas, y si las separamos ¡podemos obtener energía!
                    </div>
                    <div class="sender">
                        <img src="./img/head_w.png" />
                        <span>Karen</span>
                    </div>
                </div>
                <div class="mine messages">
                  <div class="message">
                    Estar dentro del reactor durante este paso es muy peligroso, por lo que se hace con máquinas.
                   </div>
                   <div class="message last">
                    Puedes simular tu propia fisión <u class="bold">pasando el ratón sobre las partículas en la pantalla</u>.
                   </div>
                   <div class="sender">
                       <span>Juanito</span>
                    <img src="./img/head_m.png" />
                </div>
                </div>
              </div>
              <div id="collision"></div>
        </div>
    </section>

    <section class="main" id="section4">
        <div class="navigation">
            <h2 class="glowing">Cámara de vapor</h2>
            <a href="#section2">Volver a la central</a>
        </div>
        <div class="horizontal">
            <div id="vis" class="flex flex-wrap max-width-1600 mx-auto my2 js-circles"></div>
            <div class="chat">
                <div class="yours messages">
                    <div class="message">
                        La energía nuclear no se puede usar directamente para obtener electricidad, ¡primero hay que transformarla en energía termal!
                    </div>
                    <div class="message">
                        Esto es para evaporar agua que se usará en el siguiente paso de generación eléctrica.
                    </div>
                    <div class="message last">
                        Todos los procesos que te mencionaremos son monitoreados constantemente, ¡por lo que son muy seguros!
                    </div>
                    <div class="sender">
                        <img src="./img/head_w.png" />
                        <span>Karen</span>
                    </div>
                </div>
                <div class="mine messages">
                  <div class="message">
                    …bueno, más bien son relativamente seguros.
                   </div>
                   <div class="message">
                    A lo largo de la historia han ocurrido algunos accidentes bastante importantes.
                   </div>
                   <div class="message last">
                        Para clasificarlos se usa la escala INES, que va del cero al siete en grados de seriedad. Hemos decidido mostrarte los más importantes, <u class="bold">los puedes observar poniendo el ratón sobre los círculos en la pantalla.</u>
                   </div>
                   <div class="sender">
                       <span>Juanito</span>
                    <img src="./img/head_m.png" />
                </div>
                </div>
            </div>
        </div>
    </section>

    <section class="main" id="section5">
        <div class="navigation">
            <h2 class="glowing">Turbinas</h2>
            <a href="#section2">Volver a la central</a>
        </div>
        <div class="horizontal">
            <div>
                <object id="svg-map" type="image/svg+xml" data="./img/map.svg"></object>
                <div style="margin-top: 10px;">
                    <span style="font-size: large; max-width: 100px;">Haz click en las opciones para mostrar información de cada una</span>
                    <div class="circle-data" data-attr="act" style="margin-top: 20px;">
                        <div class="circle" style="background-color: #C4F352;"></div>
                        <span class="circle-info">Activas<br>Plantas nucleares siendo utilizadas.</span>
                    </div>
                    <div class="circle-data" data-attr="des">
                        <div class="circle" style="background-color: #64E31A;"></div><span class="circle-info">Desmanteladas<br> El ciclo de vida de estas plantas ha terminado, por lo que se están desmantelando por seguridad.</span>
                    </div>
                    <div class="circle-data" data-attr="desc">
                        <div class="circle" style="background-color: #2AB323;"></div><span class="circle-info">Desconectadas<br>El uso de estas plantas se ha suspendido por precaución o debido a una falla técnica.</span>
                    </div>
                    <div class="circle-data" data-attr="ctr">
                        <div class="circle" style="background-color: #175F1C"></div><span class="circle-info">En construcción<br>Estas plantas están siendo construidas.</span>
                    </div>
                    <div class="circle-data" data-attr="acc">
                        <div class="circle" style="background-color: #F13BFB;"></div><span class="circle-info">Accidentadas<br>Un accidente ocurrió en esta planta.</span>
                    </div>

                </div>
            </div>
            <div class="chat">
                <div class="yours messages">
                    <div class="message">
                        El vapor de agua obtenido después del proceso de fisión se utiliza en este paso para accionar una serie de turbinas.
                    </div>
                    <div class="message">
                        De esta manera, ¡la energía termal se convierte en energía mecánica! 
                    </div>
                    <div class="message last">
                        Todas las plantas de energía nuclear alrededor del mundo funcionan con este sistema o alguna variación similar.
                    </div>
                    <div class="sender">
                        <img src="./img/head_w.png" />
                        <span>Karen</span>
                    </div>
                </div>
                <div class="mine messages">
                  <div class="message">
                    Hablando de plantas nucleares en el mundo, aquí te presentamos un mapa que ubica las plantas nucleares.
                   </div>
                   <div class="message">
                    <u class="bold">Puedes seleccionar su clasificación dando clic al botón correspondiente.</u>
                   </div>
                   <div class="message">
                    Las plantas se clasifican como activas, en construcción, desmanteladas y desconectadas.
                   </div>
                   <div class="message last">
                    Decidimos también mostrarte aquellas donde ha habido accidentes para dar perspectiva sobre este fenómeno.
                   </div>
                    <div class="sender">
                        <span>Juanito</span>
                        <img src="./img/head_m.png" />
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="main" id="section6">
        <div class="navigation">
            <h2 class="glowing">Transformador</h2>
            <a href="#section2">Volver a la central</a>
        </div>
        <div class="horizontal">
            <div style="padding: 100px;">
                <object id="graphs" type="image/svg+xml" data="./img/graficos.svg"></object>
                
                <input type="radio" id="r-const" name="graph" value="r_const" checked>
                <label for="r-const"><span>Construcción</span></label><br>
                
                <input type="radio" id="r-mant" name="graph" value="r_mant">
                <label for="r-mant"><span>Mantención</span></label><br>
                
                <input type="radio" id="r-desm" name="graph" value="r_desm">
                <label for="r-desm"><span>Desmantelamiento</span></label><br>

                <input type="radio" id="r-ener" name="graph" value="r_ener">
                <label for="r-ener"><span>Energía al año</span></label><br>

                <input type="radio" id="r-cont" name="graph" value="r_cont">
                <label for="r-cont"><span>Contaminación</span></label><br>

                <input type="radio" id="r-hum" name="graph" value="r_hum">
                <label for="r-hum"><span>Humanos</span></label><br>

                <input type="radio" id="r-efec" name="graph" value="r_efec">
                <label for="r-efec"><span>Efectividad</span></label><br>
            </div>
            <div class="chat">
                <div class="yours messages">
                    <div class="message">
                        ¡Aquí finalmente obtenemos energía eléctrica! Esto ocurre utilizando un transformador de energía mecánica utilizando un imán.
                    </div>
                    <div class="message last">
                        Luego, ¡esta electricidad puede ser repartida a todos lados! Además, como el transformador es bastante estándar, ¡los costos de mantención son muy reducidos!
                    </div>
                    <div class="sender">
                        <img src="./img/head_w.png" />
                        <span>Karen</span>
                    </div>
                </div>
                <div class="mine messages">
                  <div class="message">
                    Bueno, los costos de mantención pueden ser reducidos, pero existen otros costos que se deben considerar, como los costos ambientales y humanitarios.
                   </div>
                   <div class="message last">
                    Los gráficos que te mostramos comparan algunos de los costos más importantes en comparación a otros medios de producción energética.
                   </div>
                   <div class="sender">
                    <span>Juanito</span>
                    <img src="./img/head_m.png" />
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="main" id="section7">
        <div class="navigation">
            <h2 class="glowing">Torre de enfriamiento</h2>
            <a href="#section2">Volver a la central</a>
        </div>
        <div class="horizontal">
            <!-- <canvas id="waste" width="860" height="600"></canvas> -->
            <div style="display: flex; flex-direction: column; align-items: center;">
                <img id="slider-img" width="600" height="1200" />
                <input style="margin-top: -300px;" id="slide" type="range" min="1" max="7" value="1" oninput="displayValue(event)" />
                <span id="val" style="text-align: center;"></span>
                <div id="slider-content"></div>
            </div>
            <div class="chat">
                <div class="yours messages">
                    <div class="message">
                        El último paso que ocurre en la planta es el desecho de residuos y el enfriamiento del agua utilizada.
                    </div>
                    <div class="message">
                        Mucho del vapor de agua utilizado se puede volver a usar, y el resto se retorna a la atmósfera.
                    </div>
                    <div class="message last">
                        Este vapor tiene muy poco impacto en el ambiente, ¡por lo que emiten menos dióxido de carbono que la mayoría de los generadores eléctricos renovables!
                    </div>
                    <div class="sender">
                        <img src="./img/head_w.png" />
                        <span>Karen</span>
                    </div>
                </div>
                <div class="mine messages">
                  <div class="message">
                    Es cierto que las emisiones de dióxido de carbono son relativamente bajas, pero existen otros contaminantes presentes en los deshechos.
                   </div>
                   <div class="message">
                    Mucho del combustible sigue siendo radiactivo después de mucho tiempo, y por el momento no existen soluciones concretas para deshacerse de estos desechos.
                   </div>
                   <div class="message last">
                    Los efectos de estos materiales en el cuerpo humano pueden ser muy severos, 
                    <u class="bold">los puedes observar usando el deslizador en pantalla.</u>
                   </div>
                   <div class="sender">
                    <span>Juanito</span>
                    <img src="./img/head_m.png" />
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="main" id="section8">
        <div class="navigation">
            <h2 class="glowing">Sala de control</h2>
            <a href="#section2">Volver a la central</a>
        </div>
        <div class="horizontal">
            <div id="comments-container" style="max-height: 600px; overflow: scroll;"></div>
            <div>
                <p id="typewriter-3" class="glowing"></p>
                <div style="display: flex;">
                    <input style="flex: 1;" id="comment-input" placeholder="Escribe tu comentario aquí"/>
                    <button onclick="handleOnclick();" style="max-width: 100px;">Enviar</button>
                </div>
            </div>
        </div>
    </section>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
    <script src="https://d3js.org/d3-random.v2.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>
    <script src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script>
    <script src="./datamaps.world.min.js"></script>
    <script src="./index.js"></script>
    <script src="./d3-scale.v3.min.js"></script>
    <script src="./collision.js"></script>
    <script src="./script.js"></script>
    <script src="./waste.js"></script>
    <!-- <script src="./radioactivity.js"></script> -->
    <script src="assets/slider.js"></script>
    <script>

            function onClick(){
                // document.body.classList.remove("stop-scrolling");
                document.getElementById("section2").scrollIntoView();
            }

        function handleOnclick() {
            const name = document.getElementById("name").value;
            const comment = document.getElementById("comment-input").value;
            const container = document.getElementById("comments-container");
            const node = document.createElement('div');
            node.style.margin = "50px 0px";
            node.innerHTML = `<img src="../img/comentarios.svg" width=50 height=50 /><br><span>${name}</span><br><span>${comment}</span>`
            container.appendChild(node);
        } 

        window.onload = function() {
            const graphLinks = {
                r_const: "Capa_2",
                r_mant: "Capa_3_1_",
                r_desm: "Capa_4_1_",
                r_ener: "Capa_5_1_",
                r_cont: "Capa_6_1_",
                r_hum: "Capa_7_1_",
                r_efec: "Capa_8_1_",
            };

            const svgBaseDocument = document.getElementById("nuclear-plant").contentDocument;
            const svgMapBaseDocument = document.getElementById("svg-map").contentDocument;
            const svgGraphsBaseDocument = document.getElementById("graphs").contentDocument;

            svgMapBaseDocument.getElementById("Capa_1").style.visibility = "hidden";

            svgBaseDocument.getElementById("Capa_XX").addEventListener("click", (e) => {
                console.log(e.target);
                document.getElementById("section3").scrollIntoView();
            });
            svgBaseDocument.getElementById("Capa_15").addEventListener("click", () => {
                document.getElementById("section4").scrollIntoView();
            });
            svgBaseDocument.getElementById("Capa_4").addEventListener("click", () => {
                document.getElementById("section5").scrollIntoView();
            });
            svgBaseDocument.getElementById("Capa_11").addEventListener("click", () => {
                document.getElementById("section7").scrollIntoView();
            });
            svgBaseDocument.getElementById("Capa_5").addEventListener("click", () => {
                document.getElementById("section8").scrollIntoView();
            });
            svgBaseDocument.getElementById("Capa_3").addEventListener("click", () => {
                document.getElementById("section6").scrollIntoView();
            });

            // make all map circles hidden
            function reset() {
                for (let index = 7; index < 12; index++) {
                    svgMapBaseDocument.querySelectorAll(`.st${index}`).forEach(x => {
                        x.style.visibility = "hidden";
                    })
                }
            }

            // make all graphs hidden
            function resetGraphs() {
                svgGraphsBaseDocument.getElementById("Capa_2").style.visibility = "hidden";
                for (let index = 3; index < 9; index++) {
                    svgGraphsBaseDocument.getElementById(`Capa_${index}_1_`).style.visibility = "hidden";
                }
            }

            reset();
            resetGraphs();
            svgGraphsBaseDocument.getElementById(`Capa_2`).style.visibility = "initial";

            const circleData = document.querySelectorAll('.circle-data');
            circleData.forEach(el => {
                el.addEventListener('click', event => {
                    event.preventDefault();
                    if (event.target !== el) {
                        const elemData = el.getAttribute("data-attr");
                        
                        if (elemData === "act") {
                            svgMapBaseDocument.querySelectorAll(".st10").forEach(x => {
                                x.style.visibility = x.style.visibility === "initial" ? "hidden" : "initial";
                            })
                        } else if (elemData === "ctr") {
                            svgMapBaseDocument.querySelectorAll(".st7").forEach(x => {
                                x.style.visibility = x.style.visibility === "initial" ? "hidden" : "initial";
                            })
                        } else if (elemData === "des") {
                            svgMapBaseDocument.querySelectorAll(".st9").forEach(x => {
                                x.style.visibility = x.style.visibility === "initial" ? "hidden" : "initial";                            
                            })

                        } else if (elemData === "desc") {
                            svgMapBaseDocument.querySelectorAll(".st8").forEach(x => {
                                x.style.visibility = x.style.visibility === "initial" ? "hidden" : "initial";                            
                            })

                        } else if (elemData === "acc") {
                            svgMapBaseDocument.querySelectorAll(".st11").forEach(x => {
                                x.style.visibility = x.style.visibility === "initial" ? "hidden" : "initial";                            
                            })
                        }
                        
                    }
                })
            });
    
            new TypeIt(".typewriter", {
                strings: ["¡Hola, te tenemos buenas noticias!<br/>", "Tu solicitud para trabajar en nuestra planta de energía nuclear ha sido aceptada. Karen y Juanito, supervisores de la planta, te daran un tour por las instalaciones para que aprendas todo sobre ella.", "Como trabajar en la planta es algo riesgoso, te pedimos atentamente que firmes en el cuadro de texto de abajo para evitar cualquier tipo de acción legal en caso de lesión."],
                speed: 30,
                waitUntilVisible: true,
                afterComplete: async (step, instance) => {
                    const nameElem = document.getElementById("name-wrapper");
                    nameElem.removeAttribute("hidden");
                }
            }).go();

            new TypeIt("#typewriter-2", {
                strings: "Haz clic en el lugar de la planta que quieras visitar.",
                speed: 50,
                waitUntilVisible: true,
            }).go();

            new TypeIt("#typewriter-3", {
                strings: ["¿Qué piensas acerca de implementar la energía nuclear para generar energía?", "¡Queremos saber tu opinión!"],
                speed: 50,
                waitUntilVisible: true
            }).go();

            function onCheckedRadioButton(event) {
                const { target: { value } } = event;
                resetGraphs();
                svgGraphsBaseDocument.getElementById(graphLinks[value]).style.visibility = "initial";
            }

            document.querySelectorAll("input[name='graph']").forEach((input) => {
                input.addEventListener('change', onCheckedRadioButton);
            });

            
            const url = 'https://little-sister.herokuapp.com/users/opinions';

            axios.get(url)
            .then(function (response) {
                // handle success
                const { data } = response;
                const container = document.getElementById("comments-container");
                data.forEach(element => {
                    const { name, comment } = element;
                    const node = document.createElement('div');
                    node.style.margin = "50px 0px";
                    node.innerHTML = `<img src="../img/comentarios.svg" width=50 height=50 /><br><span>${name}</span><br><span>${comment}</span>`
                    container.appendChild(node)
                });
            })
            .catch(function (error) {
                // handle error
                console.log(error);
            })
            .then(function () {
                // always executed
            });
        };
    </script>
    </script>
</body>

</html>